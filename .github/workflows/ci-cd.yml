- name: Deploy on VPS with SSH
  uses: appleboy/ssh-action@v0.1.9
  with:
    host: ${{ secrets.VPS_HOST }}
    username: ${{ secrets.VPS_USER }}
    key: ${{ secrets.VPS_SSH_KEY }}
    script: |
      echo "=== Starting deployment ==="
      
      # Проверка и создание директории
      if [ ! -d "/opt/pelikan-admin-docker" ]; then
        echo "Creating directory..."
        sudo mkdir -p /opt/pelikan-admin-docker
        sudo chown $USER:$USER /opt/pelikan-admin-docker
      fi
      
      cd /opt/pelikan-admin-docker
      
      # Инициализация Git если нужно
      if [ ! -d ".git" ]; then
        echo "Initializing Git repository..."
        git init
        git remote add origin https://github.com/Andreyhiitola/pelikan-admin-docker.git
      fi
      
      # Обновление кода
      echo "Pulling latest changes..."
      git fetch origin main
      git reset --hard origin/main
      
      # Обновление образа
      echo "Pulling Docker image..."
      docker pull andreysagurov/pelikan-admin:latest
      
      # Перезапуск контейнеров
      echo "Restarting containers..."
      docker-compose down || true
      docker-compose up -d
      
      # Проверка статуса
      echo "=== Deployment complete ==="
      docker-compose ps

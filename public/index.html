<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ü–µ–ª–∏–∫–∞–Ω –ê–ª–∞–∫–æ–ª—å</title>
    <style>
        * {
            margin: 0; padding: 0; box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #3b82f6, #10b981);
            color: white; padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex; justify-content: space-between; align-items: center;
            flex-wrap: wrap; gap: 1rem;
        }
        .header-left h1 {
            font-size: 2rem; margin-bottom: 0.5rem;
        }
        .header-left p { opacity: 0.9; }
        .btn-token {
            padding: 12px 24px; background: white; color: #3b82f6;
            border: none; border-radius: 8px; font-weight: 600;
            cursor: pointer; transition: all 0.3s; font-size: 1rem;
        }
        .btn-token:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .container {
            max-width: 1400px; margin: 0 auto; padding: 2rem;
        }
        .token-setup {
            background: #fef3c7; padding: 1.5rem; border-radius: 12px;
            margin-bottom: 2rem; border-left: 4px solid #f59e0b;
        }
        .tabs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .tab {
            padding: 1.5rem; background: white; border: 2px solid #e5e7eb;
            border-radius: 12px; cursor: pointer; transition: all 0.3s;
        }
        .tab:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        }
        .tab.active {
            background: #3b82f6; color: white; border-color: #3b82f6;
        }
        .tab-title {
            font-size: 1.2rem; font-weight: 600; margin-bottom: 0.25rem;
        }
        .tab-desc {
            font-size: 0.9rem; opacity: 0.8;
        }
        .editor-section {
            background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .editor {
            width: 100%; border: 2px solid #e5e7eb; border-radius: 8px;
            padding: 1rem; min-height: 500px; font-family: 'Courier New', monospace;
            font-size: 14px; resize: vertical; line-height: 1.6;
        }
        .actions {
            margin-top: 1.5rem; display: flex; gap: 1rem;
        }
        .btn {
            padding: 12px 28px; border: none; border-radius: 8px;
            font-size: 1rem; font-weight: 600; cursor: pointer;
            transition: all 0.3s;
        }
        .btn-primary {
            background: #3b82f6; color: white;
        }
        .btn-primary:hover {
            background: #2563eb;
        }
        .btn-secondary {
            background: #6b7280; color: white;
        }
        .status {
            padding: 1rem; border-radius: 8px; margin-top: 1rem; display: none;
        }
        .status.success {
            background: #d1fae5; color: #065f46; display: block;
        }
        .status.error {
            background: #fee2e2; color: #991b1b; display: block;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <h1>üê¶ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ü–µ–ª–∏–∫–∞–Ω</h1>
            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º</p>
        </div>
        <button class="btn-token" onclick="setupToken()">üîë –¢–æ–∫–µ–Ω</button>
    </div>

    <div class="container">
        <div class="token-setup" id="tokenSetup" style="display:none;">
            <strong>‚ö†Ô∏è –ù–∞—Å—Ç—Ä–æ–π—Ç–µ GitHub —Ç–æ–∫–µ–Ω</strong>
        </div>

        <div class="tabs" id="tabs"></div>

        <div class="editor-section">
            <h2 id="sectionTitle">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª</h2>
            <textarea id="editor" class="editor"></textarea>

            <div class="actions">
                <button class="btn btn-primary" onclick="saveChanges()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn btn-secondary" onclick="reload()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>

            <div class="status" id="status"></div>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        const API = 'https://api.github.com';
        let token = localStorage.getItem('github_token') || '';
        let section = null;
        let sha = '';

        function setupToken() {
            const t = prompt('GitHub Token:');
            if (t) {
                token = t.trim();
                localStorage.setItem('github_token', token);
                alert('‚úÖ –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
                document.getElementById('tokenSetup').style.display = 'none';
            }
        }

        function generateTabs() {
            const html = CONFIG.sections.map(s => \`
                <div class="tab" onclick="loadSection('\${s.id}')">
                    <div class="tab-title">\${s.name}</div>
                    <div class="tab-desc">\${s.description}</div>
                </div>
            \`).join('');
            document.getElementById('tabs').innerHTML = html;
        }

        async function loadSection(id) {
            if (!token) {
                alert('–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ç–æ–∫–µ–Ω!');
                return;
            }

            section = id;
            const cfg = CONFIG.sections.find(s => s.id === id);
            const repo = CONFIG.repos[cfg.repo];
            const path = \`\${cfg.file}\`;

            document.getElementById('sectionTitle').textContent = cfg.name;
            document.getElementById('editor').value = '–ó–∞–≥—Ä—É–∑–∫–∞...';

            try {
                const r = await fetch(\`\${API}/repos/\${repo}/contents/\${path}\`, {
                    headers: { 'Authorization': \`token \${token}\` }
                });
                const data = await r.json();

                const content = decodeURIComponent(escape(atob(data.content)));

                document.getElementById('editor').value = content;
                sha = data.sha;

                setActiveTab(id);

                showStatus('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ', 'success');
            } catch (e) {
                alert('–û—à–∏–±–∫–∞: ' + e.message);
                showStatus('‚ùå ' + e.message, 'error');
            }
        }

        async function saveChanges() {
            if (!token || !section) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª!');
                return;
            }

            const editor = document.getElementById('editor');
            const cfg = CONFIG.sections.find(s => s.id === section);
            const repo = CONFIG.repos[cfg.repo];
            const path = \`\${cfg.file}\`;

            try {
                const r = await fetch(\`\${API}/repos/\${repo}/contents/\${path}\`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': \`token \${token}\`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: \`Update \${cfg.name}\`,
                        content: btoa(unescape(encodeURIComponent(editor.value))),
                        sha: sha
                    })
                });

                const data = await r.json();
                sha = data.content.sha;
                alert('‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
                showStatus('‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ', 'success');
            } catch (e) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + e.message);
                showStatus('‚ùå ' + e.message, 'error');
            }
        }

        function reload() {
            if (section) loadSection(section);
        }

        function showStatus(msg, type) {
            const s = document.getElementById('status');
            s.textContent = msg;
            s.className = \`status \${type}\`;
            s.style.display = 'block';
            setTimeout(() => s.style.display = 'none', 3000);
        }

        function setActiveTab(id) {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            const activeTab = Array.from(tabs).find(t => t.textContent.includes(CONFIG.sections.find(s => s.id === id).name));
            if (activeTab) activeTab.classList.add('active');
        }

        window.onload = () => {
            generateTabs();
            if (!token) document.getElementById('tokenSetup').style.display = 'block';
        };
    </script>
</body>
</html>
